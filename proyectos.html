document.addEventListener('DOMContentLoaded', () => {
  const user = JSON.parse(localStorage.getItem('user'));

  // Verifica que sea un admin
  if (!user || user.role !== 'admin') {
    alert('Acceso no autorizado');
    window.location.href = 'login.html';
    return;
  }

  const eventTableBody = document.getElementById('eventTableBody');

  // Cargar eventos desde JSON Server
  const loadEvents = async () => {
    const res = await fetch('http://localhost:3000/events');
    const events = await res.json();
    eventTableBody.innerHTML = '';

    events.forEach((event, index) => {
      eventTableBody.innerHTML += `
        <tr>
          <td>${index + 1}</td>
          <td>${event.title}</td>
          <td>${event.date}</td>
          <td>${event.capacity}</td>
          <td>
            <a href="event_edit.html?id=${event.id}" class="btn btn-sm btn-primary">Editar</a>
            <button onclick="deleteEvent(${event.id})" class="btn btn-sm btn-danger ms-2">Eliminar</button>
          </td>
        </tr>
      `;
    });
  };

  loadEvents();

  // Eliminar evento
  window.deleteEvent = async (id) => {
    if (confirm("¿Seguro que deseas eliminar este evento?")) {
      await fetch(`http://localhost:3000/events/${id}`, { method: 'DELETE' });
      loadEvents();
    }
  };

  // Cerrar sesión
  const logoutBtn = document.getElementById("logoutBtn");
  logoutBtn.addEventListener("click", () => {
    localStorage.removeItem("user");
    window.location.href = "login.html";
  });
});